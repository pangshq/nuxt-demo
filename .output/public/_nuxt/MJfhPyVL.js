import{d as y,r as v,g as l,L as b,z as d,D as i,A as c,C as o,I as g,G as u,y as f,U as S,R as T,S as I,V as N,B as O,aa as U,E as p,O as W,P as j,_ as x,ab as A}from"#entry";const E={class:"hd"},K={class:"list"},L={class:"bubble"},P={class:"input"},R=y({__name:"ChatWidget",setup(h){const n=v(!1),e=v(""),r=v(!1),a=v([{role:"assistant",text:"您好，我是智能客服。可以问我关于页面功能、基金指标等问题~",time:Date.now()}]),_=async()=>{const m=e.value.trim();if(m){e.value="",a.value.push({role:"user",text:m,time:Date.now()}),r.value=!0;try{const t=await $fetch("/api/ai/chat",{method:"POST",body:{text:m},headers:{"content-type":"application/json"}});a.value.push({role:"assistant",text:t.reply,time:Date.now()})}catch{a.value.push({role:"assistant",text:"抱歉，服务暂时不可用，请稍后再试。",time:Date.now()})}finally{r.value=!1,await j();const t=document.querySelector(".ai-chat-pane .list");t&&t.scrollTo({top:t.scrollHeight})}}},C=()=>n.value=!n.value;return(m,t)=>{const w=l("van-floating-bubble"),k=l("van-icon"),V=l("van-loading"),D=l("van-field"),$=l("van-button"),z=l("van-popup"),B=W;return d(),b(B,null,{default:i(()=>[c("div",null,[o(w,{axis:"xy",icon:"chat-o",offset:{x:20,y:100},teleport:"body",onClick:C}),o(z,{show:u(n),"onUpdate:show":t[2]||(t[2]=s=>g(n)?n.value=s:null),position:"bottom",class:"ai-chat-pane",style:{height:"50vh"},round:"","safe-area-inset-bottom":""},{default:i(()=>[c("div",E,[t[3]||(t[3]=c("div",{class:"title"},"AI 智能客服",-1)),o(k,{name:"cross",size:"18",onClick:t[0]||(t[0]=s=>n.value=!1)})]),c("div",K,[(d(!0),f(T,null,I(u(a),s=>(d(),f("div",{key:s.time,class:N(["msg",s.role])},[c("div",L,O(s.text),1)],2))),128)),u(r)?(d(),b(V,{key:0,size:"20",class:"loading"})):S("",!0)]),c("div",P,[o(D,{modelValue:u(e),"onUpdate:modelValue":t[1]||(t[1]=s=>g(e)?e.value=s:null),placeholder:"请输入问题，例如：近1年回撤多少？",clearable:"",onKeyup:U(_,["enter"])},null,8,["modelValue"]),o($,{type:"primary",size:"small",loading:u(r),onClick:_},{default:i(()=>[...t[4]||(t[4]=[p("发送",-1)])]),_:1},8,["loading"])])]),_:1},8,["show"])])]),_:1})}}}),q=Object.assign(x(R,[["__scopeId","data-v-7f907350"]]),{__name:"ChatWidget"}),F={class:"app-layout"},G=y({__name:"default",setup(h){return(n,e)=>{const r=q,a=l("van-tabbar-item"),_=l("van-tabbar");return d(),f("div",F,[A(n.$slots,"default",{},void 0),o(r),o(_,{route:"",fixed:"",placeholder:"","safe-area-inset-bottom":""},{default:i(()=>[o(a,{replace:"",to:"/",icon:"home-o"},{default:i(()=>[...e[0]||(e[0]=[p("主页",-1)])]),_:1}),o(a,{replace:"",to:"/strategy",icon:"bulb-o"},{default:i(()=>[...e[1]||(e[1]=[p("策略",-1)])]),_:1}),o(a,{replace:"",to:"/tools",icon:"apps-o"},{default:i(()=>[...e[2]||(e[2]=[p("工具",-1)])]),_:1}),o(a,{replace:"",to:"/me",icon:"user-o"},{default:i(()=>[...e[3]||(e[3]=[p("我的",-1)])]),_:1})]),_:1})])}}}),J=x(G,[["__scopeId","data-v-c61e399a"]]);export{J as default};
